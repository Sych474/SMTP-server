\documentclass[a4paper,12pt]{report}

\input{header.tex}

\title{Расчетно-Пояснительная Записка \\
    \large к курсовой работе на тему: \\ Серверная часть MTA SMTP}
\author{Сычев С.А. ИУ7-32М}

\begin{document}

\maketitle

\tableofcontents

\newpage
\chapter*{Введение}
\addcontentsline{toc}{chapter}{Введение}

Данная работа посвящена разработке серверной части почтового сервера MTA (англ. Message Transfer Agent), использующего протокол SMTP (англ. Simple Mail Transfer Protocol) - сетевой протокол, предназначенный для передачи электронной почты в сетях TCP/IP. 

Цель работы: спроектировать, разработать и протестировать серверную часть почтового SMTP-сервера (MTA), обеспечивающую локальную доставку сообщений и их добавление в очередь удаленной доставки. 

Дополнительные условия:
\begin{itemize}
\item Использовать системный вызов \texttt{poll()};
\item Использовать рабочие процессы;
\item Журналирование осуществлять в отдельном процессе.
\item Требуется проверять обратную зону DNS.
\end{itemize}

Основные задачи:
\begin{enumerate}
    \item Анализ ...;
    \item Проектирование ...;
    \item Реализация SMTP-сервера; 
    \item Тестирование и отладка реализованного программного обеспечения;
    \item Оформление расчетно-пояснительной записки по результатам работы.
\end{enumerate}

\newpage
\chapter{Аналитический раздел}

\section{Протокол SMTP}
SMTP ~-- это сетевой протокол, предназначенный для передачи писем электронной почты в сетях TCP/IP. SMTP впервые был описан в RFC 821 (1982 год), а последнее обновление описано в RFC 5321 (2008 год) и включает масштабируемое расширение протокола — ESMTP (Extended SMTP). В настоящее время под протоколом SMTP подразумеваются и его расширения. Протокол SMTP предназначен для передачи исходящей почты с использованием порта TCP 25.

Взаимодействие в рамках SMTP строится по принципу двусторонней связи, устанавливаемой   между отправителем и получателем почтового сообщения. При этом отправитель инициирует соединение и посылает запросы, а получатель - отвечает на эти запросы. Таким образом, отправитель выступает в роли клиента, а получатель - сервера.

\subsection{Команды протокола SMTP}

Команды протокола SMTP начинаются с названий - ключевых слов, указывающих, какую операцию хочет осуществить клиент.
За ключевым словом следуют, отделенные пробелом, параметры. Конец команды обозначается последовательностью символов \textbackslash r\textbackslash n - обозначаемой CRLF. 

Ниже представлен список базовых SMTP-команд:
\begin{itemize}
	\item \textbf{HELO [доменное имя клиента] CRLF} - Открывает SMTP сессию. В RFC 2821 рекомендуется использовать команду HELO, только если программное обеспечение не поддерживает команду EHLO.
	\item \textbf{EHLO [доменное имя клиента] CRLF} - Открывает ESMTP сессию. В ответ на эту команду сервер сообщает, готов ли он к продолжению диалога.
	\item \textbf{MAIL FROM: <адрес\_отправителя> CRLF} - Сообщает адрес отправителя письма. Команда MAIL должна быть выполнена для письма только один раз и только после успешного выполнения команды EHLO или HELO.
	\item \textbf{RCPT TO: <адрес\_получателя> CRLF} - Сообщает адрес получателя письма. Доставка сообщения возможна, только если указан хотя бы один адрес получателя. Команда RCPT может быть выполнена только после успешного выполнения команды MAIL и должна быть повторена для каждого получателя письма.
	\item \textbf{DATA CRLF} - Сообщает о готовности ввода текста письма. Команда DATA может быть выполнена только после успешного выполнения хотя бы одной команды RCPT. После успешного ответа сервера, клиент начинает передачу текста письма, с учетом заголовков. Сервер определяет окончание текста письма по последовательности: CRLF . CRLF
	\item \textbf{RSET CRLF} - Сброс SMTP соединения. Команда RSET аннулирует все переданные до нее на сервер данные.
	\item \textbf{VRFY <адрес> CRLF} - Проверяет наличия указанного в качестве аргумента почтового адреса.
	\item \textbf{QUIT CRLF} - Закрывает SMTP сессию.
\end{itemize}

Существуют также и другие команды ESMTP, однако в данной работе они не рассматриваются. 

\subsection{Ответы SMTP сервера}

Ответ SMTP сервера состоит из кода ответа, за которым через пробел следует дополнительный текст. Код служит индикатором состояния сервера и делится на четыре группы:
\begin{itemize}
	\item \textbf{2xx} - команда выполнена успешно;
	\item \textbf{3xx} - ромежуточный положительный результат. Команда принята, но сервер ожидает от клиента дополнительные данные для завершения операции;
	\item \textbf{4xx} - исполнение команды временно невозможно. Команда не может быть выполнена, но проблема может быть устранена;
	\item \textbf{5xx} - исполнение команды невозможно.
\end{itemize}

Если ответ сервера состоит из нескольких строк, то каждая из них начинается кодом, который отделяется от сопровождающего текста не пробелом, а символом "минус"\ (-). В последней строке номер отделяется от текста пробелом. Каждая строка ответа, как и строки команд, заканчивается последовательностью CRLF.

\section{Преимущества и недостатки использования системного вызова poll.}
TODO

Системный вызов poll, по сравнению с другими системными вызовами опроса сокетов имеет следующие достоинства: 
\begin{itemize}
	\item Нет активного ожидания на процессоре.
	\item Позволяет обрабатывать больше 1024 клиентов по сравнению с системным вызовом \texttt{select()}.
	\item Не модифицируется структура pollfd, что даёт возможность её переиспользования между вызовами poll() — нужно лишь обнулить поле revents.
	\item Наблюдаемые события лучше структурированы. Например, можно определить отключение удалённого клиента без необходимости чтения данных из сокета.
\end{itemize}

К его недостаткам можно отнести:
\begin{itemize}
 	\item Poll отсутствует на некоторых платформах (в основном старых). 
	\item Невозможнось определить, какие именно дескрипторы сгенерировали события, без полного прохода по всем наблюдаемым структурам и проверки поля revents. (Проблема так-же в том, что в ядре данная операция реализована так-же). 
	\item Как и при использовании select, нет возможности динамически менять наблюдаемый набор событий. 
\end{itemize}

TODO ВСТАВИТЬ ССЫЛКУ ["select/poll/epoll: практическая разница"]

\section{Преимущества и недостатки использования многопроцессного подхода обработки подключений.}
TODO

\begin{itemize}
 	\item ...
	\item ...
\end{itemize}

К минусам использования этого подхода относятся:
\begin{itemize}
    \item ...
    \item ...
\end{itemize}


\section{Сущности предметной области}

TODO

\newpage
\chapter{Конструкторский раздел}

\section{Конечный автомат состояний сервера}

\section{Синтаксис команд протокола}

\section{Описание основных структур данных}

\section{Обработка соединений в одном потоке выполнения}

\section{Связь основной программы и процесса журналирования}

\section{Хранение почты}

\chapter{Технологический раздел}

\section{Написание исходного кода}

Для написания исходного кода серверной части MTA SMTP использовался язык C стандарта C99 со стандартными системными библиотеками, а так же следующими дополнительными библиотеками:
\begin{itemize}
    \item TODO - все из sys 
    \item Autogen - для автоматической генерации конечного автомата состояний сервера.
    \item PCRE - для регулярных выражений, чтобы парсить команды от клиента.
    \item CUnit - для модульного тестирования написанного кода приложения.
\end{itemize}


\section{Платформы и компиляторы}

TODO

\section{Сборка программы}
TODO

\section{Основные функции программы}
TODO

\section{Основные структуры программы}
TODO

\section{Файл конфигурации}
TODO

\section{Графы вызова функций}
TODO

\section{Модульное тестирование}

Для модульного тестирования функций сервера в работе используется библиотека CUnit.

Тестированием покрыты: TODO
\begin{verbatim}
    TODO
\end{verbatim}


\section{Системное тестирование}

Для системного тестирования ...
TODO

\section{Тестирование утечек памяти}

Для тестирования утечек памяти использовалась утилита valgrind. Утечек памяти не обнаружено, результаты тестирования приведены ниже: 
\begin{verbatim}
    TODO
\end{verbatim}

\clearpage
\chapter*{Заключение}
\addcontentsline{toc}{chapter}{Заключение}

TODO

\newpage
\chapter*{Список литературы}
\addcontentsline{toc}{chapter}{Список литературы}

\begin{enumerate}
	\item Статья "select/poll/epoll: практическая разница" [Электронный ресурс] Режим досутпа: URL: https://habr.com/ru/company/infopulse/blog/415259/
	
\end{enumerate}

\end{document}




